<!DOCTYPE html>

 <html>
     <head>
         <title>Lab 02.01 - Ambient Light Testing</title>
	  
         <script src="three.js"></script>
		 <script src="OrbitControls.js"></script>
		 <script src="stats.js"></script>
		 <script src="dat.gui.js"></script>
 
     </head>
     <body>
	     <div id="Stats-output"> </div>
         <!-- This is the DIV element which will contain the WebGL canvas. To be identifiable later on, the id 'WebGLCanvas' is applied to it. -->
         <div id="WebGLCanvas"> </div>

        <script>
		     var stats = initStats();
             // create a scene 
             var scene = new THREE.Scene();

			 
			 // Global objects
             var camera;
			 var ctr;
			 var controls;
			 var renderer;
			 var bouncingStep = 0.0;
             var rotatingStep = 0.0;
             var sphere2xmultiplier = 1;
             var sphere2zmultiplier = 1;
		
		     // Initialize the scene
             initializeScene();
		
		     // Render the scene (map the 3D world to the 2D scene)
             renderScene();
		
		     /**
              * Initialize the scene.
              */
             function initializeScene(){
                 
				 
				
                 renderer = new THREE.WebGLRenderer({antialias:true});
                 // Set the background color of the renderer to black, with full opacity
                 renderer.setClearColor(0xAAAAAA, 0);
				  		 
				 // Get the size of the inner window (content area) to create a full size renderer
				 var canvasWidth = window.innerWidth;
                 var canvasHeight = window.innerHeight;
 
                 // Set the renderers size to the content areas size
                 renderer.setSize(canvasWidth,canvasHeight );
				 renderer.shadowMap.enabled = true;
				 //renderer.shadowMap.type = THREE.PCFSoftShadowMap; // default THREE.PCFShadowMap
                 
                 // Get the DIV element from the HTML document by its ID and append the renderers DOM
                 // object to it
                 //document.getElementById("WebGLCanvas").appendChild(renderer.domElement);
				 
				 		 
				 // create the ground plane
                 var planeGeometry = new THREE.PlaneGeometry(100, 100, 100, 100);
                 //var planeMaterial = new THREE.MeshLambertMaterial({color: 0xffffff, side:THREE.DoubleSide});
                 var planeMaterial = new THREE.MeshPhongMaterial({color: 0xffffff, side:THREE.DoubleSide});
                 var plane = new THREE.Mesh(planeGeometry, planeMaterial);
                 plane.receiveShadow = true;

                 // rotate and position the plane
                 plane.rotation.x = -0.5 * Math.PI;
                 plane.position.x = 0
                 plane.position.y = 0
                 plane.position.z = 0

                 // add the plane to the scene
                 scene.add(plane);
				 
				 // create a cube
                 cubeGeometry = new THREE.CubeGeometry(4, 4, 4, 64, 64, 64);
                 //cubeMaterial = new THREE.MeshLambertMaterial({color: 0xff0000});
                 cubeMaterial = new THREE.MeshPhongMaterial({color: 0xff0000, specular: 0xffffff, shininess: 100});
                 cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
                 cube.castShadow = true;
                 cube.receiveShadow = true;

                 // position the cube
                 cube.position.x = -4;
                 cube.position.y = 3;
                 cube.position.z = 0;

                 // add the cube to the scene
                 scene.add(cube);
				 
				 sphereGeometry = new THREE.SphereGeometry(4, 64, 32);
                 sphereMaterial = new THREE.MeshPhongMaterial({color: 0x7777ff, specular: 0xffffff, 
				 shininess: 100});
				 
				 
                 sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);

                 // position the sphere
                 sphere.position.x = 20;
                 sphere.position.y = 0;
                 sphere.position.z = 2;
                 sphere.castShadow = true;

                 // add the sphere to the scene
                 scene.add(sphere);
				 
				 
  

				 // Define camera and add it to the scene.
                 camera = new THREE.PerspectiveCamera(45, canvasWidth / canvasHeight, 1, 1000);
                 camera.position.set(-25, 30, 25);
                 camera.lookAt(scene.position);
				 scene.add(camera);
				 
				 //ctr = new THREE.OrbitControls( camera);
				 //ctr.addEventListener( 'change', renderer.domElement);
                 ctr = new THREE.OrbitControls( camera, renderer.domElement);
                 				 
				 const axesHelper = new THREE.AxesHelper( 5 );
                 scene.add( axesHelper );
				 
				 // add subtle ambient lighting
                 ambiColor = "#0a0a0a";
                 ambientLight = new THREE.AmbientLight(ambiColor);
                 scene.add(ambientLight);
				 
				 
				 // add spotlight for the shadows
                 spotLight = new THREE.SpotLight(0xffffff);
                 spotLight.position.set(50, 40, 0);
                 spotLight.castShadow = true;
		  
		         spotLight.angle = 0.2;
		         spotLight.penumbra = .7;
		         spotLight.target = sphere;
		         //var helper = new THREE.CameraHelper( spotLight.shadow.camera );
                 //scene.add( helper );
		         spotLight.shadow.camera.near = 0.1;
		         spotLight.shadow.camera.far = 100;
		         spotLight.shadow.camera.fov = 60;
		         spotLight.shadow.mapSize.width = 2048;
		         spotLight.shadow.mapSize.height = 2048;
		
		         scene.add(spotLight);


				 // moving white spotlight
                 spotLight2 = new THREE.SpotLight(0xffffff);
                 spotLight2.position.set(0, 40, 0);
                 spotLight2.castShadow = true;
		         spotLight2.angle = 0.2;
		         spotLight2.penumbra = .7;
		         spotLight2.shadow.camera.near = 0.1;
		         spotLight2.shadow.camera.far = 100;
		         spotLight2.shadow.camera.fov = 60;
		         spotLight2.shadow.mapSize.width = 2048;
		         spotLight2.shadow.mapSize.height = 2048;
		
		         scene.add(spotLight2);


                 geometry = new THREE.ConeGeometry( 7, 40, 32);
                 material = new THREE.MeshLambertMaterial( { opacity:0.2, color: 0xffffff, transparent:true } );
                 cone2 = new THREE.Mesh(geometry, material );
                 cone2.position.set(0,20,0);
                 scene.add( cone2 );

                 spotLight2.target = cone2;

                 // fast yellow spotlight
                 spotLight3 = new THREE.SpotLight(0xffff00);
                 spotLight3.position.set(0, 40, 0);
                 spotLight3.castShadow = true;
		         spotLight3.angle = 0.2;
		         spotLight3.penumbra = .7;
		         spotLight3.shadow.camera.near = 0.1;
		         spotLight3.shadow.camera.far = 100;
		         spotLight3.shadow.camera.fov = 60;
		         spotLight3.shadow.mapSize.width = 2048;
		         spotLight3.shadow.mapSize.height = 2048;
		
		         scene.add(spotLight3);


                 geometry = new THREE.ConeGeometry( 7, 40, 32);
                 material = new THREE.MeshLambertMaterial( { opacity:0.2, color: 0xffff00, transparent:true } );
                 cone3 = new THREE.Mesh(geometry, material );
                 cone3.position.set(0,20,0);
                 scene.add( cone3 );

                 spotLight3.target = cone3;


                 // wall bouncing sphere
                 sphereGeometry = new THREE.SphereGeometry(4, 64, 32);
                 sphereMaterial = new THREE.MeshPhongMaterial({color: 0x77ff77, specular: 0xffffff, 
				 shininess: 100});
				 
                 sphere2 = new THREE.Mesh(sphereGeometry, sphereMaterial);

                 sphere2.position.x = 0;
                 sphere2.position.y = 4;
                 sphere2.position.z = 0;
                 sphere2.castShadow = true;

                 scene.add(sphere2);

                 // side rotating blue spotlight
                 spotLight4 = new THREE.SpotLight(0x0000ff);
                 spotLight4.position.set(0, 50, 0);
                 spotLight4.castShadow = true;
		         spotLight4.angle = 0.1;
		         spotLight4.penumbra = .7;
		         spotLight4.shadow.camera.near = 0.1;
		         spotLight4.shadow.camera.far = 100;
		         spotLight4.shadow.camera.fov = 60;
		         spotLight4.shadow.mapSize.width = 2048;
		         spotLight4.shadow.mapSize.height = 2048;
                 spotLight4.target = cube;
		         scene.add(spotLight4);

				 
				document.getElementById("WebGLCanvas").appendChild(renderer.domElement); 
				 
				/* var bouncingStep = 0; */
                
                     controls = new function () {
                     this.rotationSpeed = 0.02;
                     this.bouncingSpeed = 0.03;
                     this.lightRotationSpeed = 0.02;
                     this.sphere2xSpeed = 0.4;
                     this.sphere2zSpeed = 0.5;
                 };
				 
				 
				 var gui = new dat.GUI();
                 gui.add(controls, 'rotationSpeed', 0, 0.5);
                 gui.add(controls, 'bouncingSpeed', 0, 0.5);
                 gui.add(controls, 'lightRotationSpeed', 0, 0.5);
                 gui.add(controls, 'sphere2xSpeed', 0, 2);
                 gui.add(controls, 'sphere2zSpeed', 0, 2);
                 gui.add(ambientLight, 'intensity', 0, 20);
				                             
        }

     

        function renderScene() {
		
		    // rotate the cube around its axes
               //cube.rotation.x += 0.02;
               //cube.rotation.y += 0.03;
               //cube.rotation.z += 0.01;
			   cube.rotation.x += controls.rotationSpeed;
               cube.rotation.y += controls.rotationSpeed;
               cube.rotation.z += controls.rotationSpeed;

            // bounce the sphere up and down
               bouncingStep += controls.bouncingSpeed;
               sphere.position.x = 20 +( 10 * (Math.cos(bouncingStep)));
               sphere.position.y = 2 + ( 10 * Math.abs(Math.sin(bouncingStep)));

               rotatingStep += controls.lightRotationSpeed;
               cone2.position.x = 20 * Math.cos(rotatingStep);
               cone2.position.z = 20 * Math.sin(rotatingStep);
               spotLight2.position.x = cone2.position.x;
               spotLight2.position.z = cone2.position.z;

               cone3.position.x = -40 * Math.cos(rotatingStep);
               cone3.position.z = -40 * Math.sin(-rotatingStep);
               spotLight3.position.x = cone3.position.x;
               spotLight3.position.z = cone3.position.z;

                sphere2.position.x += sphere2xmultiplier * controls.sphere2xSpeed;
                if (sphere2.position.x > 50 || sphere2.position.x < -50) sphere2xmultiplier = -sphere2xmultiplier;
                sphere2.position.z += sphere2zmultiplier * controls.sphere2zSpeed;
                if (sphere2.position.z > 50 || sphere2.position.z < -50) sphere2zmultiplier = -sphere2zmultiplier;


                             
               spotLight4.position.x = cone3.position.x;
               spotLight4.position.z = cone3.position.z;



            // render using requestAnimationFrame
            requestAnimationFrame(renderScene);
            renderer.render(scene, camera);
        }
		
		function initStats() {

            var stats = new Stats();

            stats.setMode(0); // 0: fps, 1: ms

            // Align top-left
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.left = '0px';
            stats.domElement.style.top = '0px';

            document.getElementById("Stats-output").appendChild(stats.domElement);

            return stats;
        }


      </script>
   </body>
</html>